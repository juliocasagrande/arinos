<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Visualização de Dados dos Parques Solares</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- Link para o Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link para o Font Awesome para adicionar ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Ajustes para a sidebar */
        body {
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .sidebar {
            min-width: 200px; /* Reduz a largura mínima */
            max-width: 200px;
            background-color: #343a40;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .sidebar a {
            color: white;
            text-decoration: none;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            width: 100%;
        }

        /* Define que cada gráfico ocupe 100% da largura da página */
        .plot-container {
            width: 100%;
            margin-bottom: 40px;
            padding: 10px;
            box-sizing: border-box;
        }

        /* Estilos para ocultar e exibir seções */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Estilo do rodapé da sidebar */
        .sidebar-footer {
            padding: 10px;
            font-size: 0.9em;
            color: #aaa;
            text-align: center;
            border-top: 1px solid #555;
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar p-3">
    <div>
        <h2>Navegação</h2>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('plots-section')">
                    <i class="fas fa-chart-line"></i> Gráficos
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('data-section')">
                    <i class="fas fa-table"></i> Dados
                </a>
            </li>
        </ul>
    </div>
    <div class="sidebar-footer">
        Designed by Júlio Casagrande
    </div>
</div>

<!-- Conteúdo Principal -->
<div class="content">
    <h1>Visualização de Dados dos Parques Solares</h1>

    <!-- Seção dos Gráficos -->
    <div id="plots-section" class="section active">
        <div id="plots"></div>
    </div>

    <!-- Seção dos Dados -->
    <div id="data-section" class="section">
        <h2>Dados dos Parques Solares</h2>
        <select id="parque-select" class="form-select" onchange="mostrarDados()">
            <option value="">Selecione um parque</option>
            <option value="ARN08">Parque ARN08</option>
            <option value="ARN09">Parque ARN09</option>
            <option value="ARN10">Parque ARN10</option>
        </select>
        <div id="data-display" class="mt-3"></div>
    </div>
</div>

<script>
    // Lista dos nomes dos parques que correspondem aos arquivos JSON
    const parques = ["ARN08", "ARN09", "ARN10"];  // Atualize com os nomes reais dos arquivos JSON

    // Função para carregar e exibir dados de cada parque
    async function carregarDados(parque) {
        const response = await fetch(`${parque}.json`);  // Acessa diretamente o arquivo JSON na raiz
        const data = await response.json();

        // Extrair dados para gráficos
        const datas = data.map(d => new Date(d.Data));
        const irradiancia = data.map(d => d['P_GHI_1 Value']);
        const angulo = data.map(d => d['_POA_ANG Value']);
        const temperatura = data.map(d => d['_T_INT Value']);

        // Criar traces para cada variável
        const traceIrradiancia = {
            x: datas,
            y: irradiancia,
            mode: 'lines',
            name: 'Irradiância',
            line: { color: 'rgba(0, 0, 255, 0.5)' }
        };

        const traceAngulo = {
            x: datas,
            y: angulo,
            mode: 'lines',
            name: 'Ângulo Tracker',
            yaxis: 'y2',
            line: { color: 'rgba(0, 128, 0, 0.5)' }
        };

        const traceTemperatura = {
            x: datas,
            y: temperatura,
            mode: 'lines',
            name: 'Temperatura',
            yaxis: 'y2',
            line: { color: 'rgba(255, 0, 0, 0.5)' }
        };

        // Configuração do layout com eixo secundário e ajuste da legenda
        const layout = {
            title: `Dados do Parque: ${parque}`,
            xaxis: { title: 'Data' },
            yaxis: { title: 'Irradiância' },
            yaxis2: {
                title: 'Ângulo e Temperatura',
                overlaying: 'y',
                side: 'right'
            },
            legend: { x: 1.05, y: 1 },  // Ajuste a posição horizontal da legenda
            margin: { l: 50, r: 80, t: 50, b: 50 },
            width: null,  // Define a largura automaticamente para 100% do contêiner
            height: 400,
            plot_bgcolor: "rgba(0,0,0,0)"  // Fundo transparente
        };

        // Renderizar gráfico no div com ID "plots"
        const plotDiv = document.createElement('div');
        plotDiv.className = 'plot-container';
        document.getElementById('plots').appendChild(plotDiv);

        Plotly.newPlot(plotDiv, [traceIrradiancia, traceAngulo, traceTemperatura], layout);
    }

    // Carregar e exibir gráficos para cada parque
    parques.forEach(parque => carregarDados(parque));

    // Função para alternar entre seções (Gráficos e Dados)
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
    }

    // Função para mostrar os dados do parque selecionado na outra página
    async function mostrarDados() {
        const parque = document.getElementById("parque-select").value;
        
        // Limpa o conteúdo anterior da tabela enquanto os novos dados são carregados
        document.getElementById("data-display").innerHTML = "Carregando...";

        if (parque) {
            const response = await fetch(`${parque}.json`);
            const data = await response.json();
            const tabelaHTML = `
                <table class="table table-striped mt-3">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Irradiância</th>
                            <th>Ângulo Tracker</th>
                            <th>Temperatura</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(row => `
                            <tr>
                                <td>${new Date(row.Data).toLocaleString()}</td>
                                <td>${formatarValor(row['P_GHI_1 Value'])}</td>
                                <td>${formatarValor(row['_POA_ANG Value'])}</td>
                                <td>${formatarValor(row['_T_INT Value'])}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById("data-display").innerHTML = tabelaHTML;
        } else {
            // Se nenhum parque foi selecionado, limpar o conteúdo
            document.getElementById("data-display").innerHTML = "";
        }
    }

    // Função para formatar valores numéricos: arredonda para 2 casas decimais e substitui valores nulos
    function formatarValor(valor) {
        return valor != null ? valor.toFixed(2) : '-';
    }
</script>

</body>
</html>
